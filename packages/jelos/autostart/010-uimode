#!/bin/sh
# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2023 JELOS (https://github.com/JustEnoughLinuxOS)

# Minimal OS variable loading for performance
. /etc/profile.d/001-functions

tocon "Configuring user interface..."

UIMODE=$(get_setting desktop.enabled)
if [ "${UIMODE}" = "1" ] || \
   [ ! -e "/storage/roms/pico-8/pico8_64" ]
then
  cp -f /usr/share/weston/weston.ini /storage/.config/weston.ini
else
  cp -f /usr/share/weston/kiosk.ini /storage/.config/weston.ini
fi

STARTUP=$(get_setting weston.startup)
if [ -z "${STARTUP}" ] && \
   [ -e "/storage/roms/pico-8/pico8_64" ]
then
  STARTUP="/usr/bin/start_pico8.sh"
  set_setting weston.startup "${STARTUP}"
fi
sed -i "s#@STARTUP@#${STARTUP}#g" /storage/.config/weston.ini
